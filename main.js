(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-33/",headers:{authorization:"d2cfe252-28ad-4ef0-9516-28ffa42d504b","Content-Type":"application/json"}},t=function(t){return fetch("".concat(e.baseUrl+t),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},n=function(t,n){return n||(n=""),fetch("".concat(e.baseUrl,"users/me/").concat(n),{method:"PATCH",headers:e.headers,body:JSON.stringify(t)}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},o=function(e){"Escape"===e.key&&c(document.querySelector(".popup_is-opened"))};function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function c(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function a(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.name,"-error"));r.textContent="",n.removeAttribute("disabled",""),t.classList.remove(o.inputErrorClass),n.classList.remove(o.inactiveButtonClass),r.classList.remove(o.errorClass)}(e,t,n,o):function(e,t,n,o){var r=e.querySelector(".".concat(t.name,"-error"));r.textContent=t.validationMessage,n.setAttribute("disabled",""),t.classList.add(o.inputErrorClass),n.classList.add(o.inactiveButtonClass),r.classList.add(o.errorClass)}(e,t,n,o)}function i(e,t){var n=e.querySelectorAll(t.inputSelector),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.validity.valid||(n.value=""),a(e,n,o,t)}))}var u=document.querySelector("#card-template").content,s=document.querySelector(".places__list"),l=document.querySelector(".profile__image"),d=document.querySelector(".profile__title"),f=document.querySelector(".profile__description"),p=document.querySelectorAll(".popup"),m=document.querySelector(".profile__edit-button"),_=document.querySelector(".popup_type_edit"),v=document.forms["edit-profile"],h=v.elements.name,y=v.elements.description,S=document.querySelector(".profile__edit-avatar-button"),b=document.querySelector(".popup_type_edit-avatar"),q=document.forms["edit-profile-avatar"],E=q.elements["link-avatar"],k=document.querySelector(".profile__add-button"),L=document.querySelector(".popup_type_new-card"),C=document.forms["new-place"],g=C.elements["place-name"],x=C.elements.link,j=document.querySelector(".popup_type_image"),A=j.querySelector(".popup__image"),P=j.querySelector(".popup__caption"),U={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function w(){t("users/me/").then((function(e){return l.style.backgroundImage="url('".concat(e.avatar,"')"),d.textContent=e.name,f.textContent=e.about,e})).then((function(e){return function(e){t("cards/").then((function(t){s.querySelectorAll(".card").forEach((function(e){return e.remove()})),t.forEach((function(t){var n=e._id===t.owner._id,o=!1;t.likes.forEach((function(t){t._id===e._id&&(o=!0)})),s.append(function(e,t,n,o,r,c,a){var i=t.querySelector(".card").cloneNode(!0),u=i.querySelector(".card__image"),s=i.querySelector(".card__title"),l=i.querySelector(".card__delete-button"),d=i.querySelector(".card__like-button"),f=i.querySelector(".card__number-of-likes");return u.src=e.link,u.alt=e.name,s.textContent=e.name,f.textContent=e.likes.length,i.dataset.cardId=e._id,c?l.addEventListener("click",(function(){return n(i.dataset.cardId)})):l.remove(),a&&d.classList.add("card__like-button_is-active"),d.addEventListener("click",(function(){o(d,i.dataset.cardId)})),u.addEventListener("click",(function(){return r(u)})),i}(t,u,D,I,B,n,o))}))}))}(e)}))}function B(e){A.src=e.src,A.alt=e.alt,P.textContent=e.alt,r(j)}var T,D=function(t){(function(t){fetch("".concat(e.baseUrl,"cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))})(t).then((function(){return w}))},I=function(t,n){t.classList.toggle("card__like-button_is-active"),function(t,n){return fetch("".concat(e.baseUrl,"cards/likes/").concat(t),{method:n,headers:e.headers}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(n,t.classList.contains("card__like-button_is-active")?"PUT":"DELETE").then((function(){return w()}))};function M(e,t){e.querySelector(".button").textContent=t}p.forEach((function(e){!function(e){e.classList.add("popup_is-animated")}(e),function(e){e.addEventListener("click",(function(t){(t.target===e||t.target.classList.contains("popup__close"))&&c(e)}))}(e)})),m.addEventListener("click",(function(){h.value=d.textContent,y.value=f.textContent,i(v,U),r(_)})),v.addEventListener("submit",(function(e){e.preventDefault(),M(v,"Сохранение..."),n({name:h.value,about:y.value}).then((function(){return w()})).then((function(){M(v,"Сохранить"),c(_)}))})),S.addEventListener("click",(function(){i(v,U),r(b)})),q.addEventListener("submit",(function(e){e.preventDefault(),M(q,"Сохранение..."),n({avatar:E.value},"avatar/").then((function(){return w()})).then((function(){M(q,"Сохранить"),q.reset(),c(b)}))})),k.addEventListener("click",(function(){i(C,U),r(L)})),C.addEventListener("submit",(function(t){var n,o;t.preventDefault(),M(C,"Сохранение..."),(n=g.value,o=x.value,fetch("".concat(e.baseUrl,"cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok&&e.json(),Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(){return w()})).then((function(){M(C,"Сохранить"),C.reset(),c(L)}))})),w(),T=U,document.querySelectorAll(T.formSelector).forEach((function(e){var t=e.querySelectorAll(T.inputSelector),n=e.querySelector(T.submitButtonSelector);t.forEach((function(t){!function(e,t,n,o){t.addEventListener("input",(function(r){a(e,t,n,o)}))}(e,t,n,T)}))}))})();